{% extends "base.html" %}

{% block title %}Login - Shift Roster Pro{% endblock %}

{% block content %}
<div class="auth-container" style="max-width: 400px; margin: 0 auto;">
    <div class="card fade-in">
        <div style="text-align: center; margin-bottom: 2rem;">
            <h2 style="color: #333; margin-bottom: 0.5rem;">
                <i class="fas fa-sign-in-alt"></i> Welcome Back
            </h2>
            <p style="color: #666;">Sign in to access your shift roster dashboard</p>
        </div>

        <div class="loading">
            <div class="spinner"></div>
            <p>Signing you in...</p>
        </div>

        <form id="loginForm">
            <div class="form-group">
                <label for="email">Email Address</label>
                <div style="position: relative;">
                    <input type="email" id="email" name="email" required 
                           placeholder="Enter your email address"
                           style="padding-left: 45px;">
                    <i class="fas fa-envelope" style="position: absolute; left: 15px; top: 50%; transform: translateY(-50%); color: #667eea;"></i>
                </div>
            </div>

            <div class="form-group">
                <label for="password">Password</label>
                <div style="position: relative;">
                    <input type="password" id="password" name="password" required 
                           placeholder="Enter your password"
                           style="padding-left: 45px; padding-right: 45px;">
                    <i class="fas fa-lock" style="position: absolute; left: 15px; top: 50%; transform: translateY(-50%); color: #667eea;"></i>
                    <i class="fas fa-eye" id="togglePassword" 
                       style="position: absolute; right: 15px; top: 50%; transform: translateY(-50%); color: #667eea; cursor: pointer;"></i>
                </div>
            </div>

            <div class="form-options" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                <label style="display: flex; align-items: center; cursor: pointer; font-weight: normal;">
                    <input type="checkbox" id="remember" name="remember" style="width: auto; margin-right: 0.5rem;">
                    Remember me
                </label>
                <a href="#" style="color: #667eea; text-decoration: none; font-size: 0.9rem;">Forgot password?</a>
            </div>

            <button type="submit" class="btn btn-primary" style="width: 100%; margin-bottom: 1.5rem;">
                <i class="fas fa-sign-in-alt"></i> Sign In
            </button>

            <div style="text-align: center; padding-top: 1rem; border-top: 1px solid #e1e5e9;">
                <p style="color: #666; margin-bottom: 1rem;">Don't have an account?</p>
                <a href="{{ url_for('register') }}" class="btn btn-secondary" style="width: 100%;">
                    <i class="fas fa-user-plus"></i> Create Account
                </a>
            </div>
        </form>
    </div>

    <!-- Demo credentials info -->
    <div class="card" style="margin-top: 2rem; background: rgba(102, 126, 234, 0.1); border: 1px solid rgba(102, 126, 234, 0.2);">
        <div style="text-align: center;">
            <h4 style="color: #667eea; margin-bottom: 1rem;">
                <i class="fas fa-info-circle"></i> Demo Access
            </h4>
            <p style="font-size: 0.9rem; color: #666; margin-bottom: 1rem;">
                New to the platform? Create your organization account to get started with your team's shift management.
            </p>
            <div style="background: rgba(255, 255, 255, 0.8); padding: 1rem; border-radius: 8px; font-size: 0.9rem; color: #333;">
                <strong>First time setup:</strong><br>
                1. Register with your organization details<br>
                2. You'll become the Super Admin<br>
                3. Start adding team members and creating rosters
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
// Toggle password visibility
document.getElementById('togglePassword').addEventListener('click', function() {
    const passwordInput = document.getElementById('password');
    const toggleIcon = this;
    
    if (passwordInput.type === 'password') {
        passwordInput.type = 'text';
        toggleIcon.classList.remove('fa-eye');
        toggleIcon.classList.add('fa-eye-slash');
    } else {
        passwordInput.type = 'password';
        toggleIcon.classList.remove('fa-eye-slash');
        toggleIcon.classList.add('fa-eye');
    }
});

// Login form submission
document.getElementById('loginForm').addEventListener('submit', async function(e) {
    e.preventDefault();
    
    const formData = new FormData(this);
    const data = Object.fromEntries(formData.entries());
    
    if (!data.email || !data.password) {
        showAlert('Please fill in all fields', 'error');
        return;
    }
    
    showLoading(true);
    
    try {
        const result = await apiCall('/login', 'POST', data);
        
        if (result.success) {
            showAlert('Login successful! Redirecting...', 'success');
            setTimeout(() => {
                window.location.href = '/dashboard';
            }, 1500);
        } else {
            showAlert(result.data.error || 'Login failed', 'error');
        }
    } catch (error) {
        showAlert('An error occurred. Please try again.', 'error');
    } finally {
        showLoading(false);
    }
});

// Add Enter key support for better UX
document.addEventListener('keypress', function(e) {
    if (e.key === 'Enter' && e.target.matches('input')) {
        const form = e.target.closest('form');
        if (form) {
            const inputs = Array.from(form.querySelectorAll('input[required]'));
            const currentIndex = inputs.indexOf(e.target);
            
            if (currentIndex < inputs.length - 1) {
                inputs[currentIndex + 1].focus();
            } else {
                form.querySelector('button[type="submit"]').click();
            }
        }
    }
});

// Auto-focus email field
document.addEventListener('DOMContentLoaded', function() {
    document.getElementById('email').focus();
});
</script>
{% endblock %}